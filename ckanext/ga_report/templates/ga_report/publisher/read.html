<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <py:def function="page_title">Analytics for ${g.site_title}</py:def>

 <py:match path="primarysidebar">

    <li class="widget-container boxed widget_text">
      <h4>${c.publisher.title}</h4>
      <p>
          The table shows the top 20 most viewed datasets belonging to ${c.publisher.title}.
      </p>
      <p>
          As well as showing the number of views within ${c.month_desc}, it will also show the
          number of visitors that viewed each dataset.
      </p>
       <p>The dataset list page for <a href="${h.url_for(controller='ckanext.dgu.controllers.publisher:PublisherController', action='read', id=c.publisher.name)}">${c.publisher.title}</a> was viewed ${c.publisher_page_views} times during ${c.month_desc}</p>
       <p>View the <a href="${h.url_for(controller='ckanext.ga_report.controller:GaPublisherReport', action='index')}">publishers</a> leaderboard</p>
    </li>
  </py:match>

  <div py:match="content">
      <h1>Analytics for ${c.publisher.title}</h1>

      <h2>Top 20 most viewed datasets</h2>
      <p><em>Note: this data does not include API calls</em></p>

      <form class="form-inline" action="${h.url_for(controller='ckanext.ga_report.controller:GaPublisherReport',action='read',id=c.publisher.name)}" method="get">
          <div class="controls">
          <select name="month">
              <py:for each="val,desc in c.months">
                <option value='${val}' py:attrs="{'selected': 'selected' if c.month == val else None}">${desc}</option>
              </py:for>
          </select>
           <input class="btn button" type='submit' value="Update"/>
          </div>
       </form>

       <table class="table table-condensed table-bordered table-striped">
	 <tr>
	   <th>Dataset</th>
	   <th>Views</th>
	   <th>Visits</th>
	 </tr>
        <py:for each="package, views, visits in c.top_packages">
	  <tr>
	    <td>${h.link_to(package.title or package.name, h.url_for(controller='package', action='read', id=package.name))}
	    </td>
	    <td>${views}</td>
	    <td>${visits}</td>
	  </tr>
        </py:for>
       </table>


  </div>

  <xi:include href="../../layout.html" />
</html>




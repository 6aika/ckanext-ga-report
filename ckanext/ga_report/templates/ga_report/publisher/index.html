<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="../ga_util.html" />

  <py:def function="page_title">Usage by Publisher</py:def>

  <py:match path="primarysidebar">
    <li class="widget-container boxed widget_text">
      <h4>Download</h4>
      <p><center>
          <a class="btn button btn-primary" href="${h.url_for(controller='ckanext.ga_report.controller:GaDatasetReport',action='publisher_csv',month=c.month or 'all')}">Download as CSV</a></center>
      </p>
    </li>
    <li class="widget-container boxed widget_text">
      <h4>Graph Legend</h4>
      <div id="graph-legend-container">
      </div>
    </li>
    <xi:include href="../notes.html" />
  </py:match>

  <py:def function="optional_head">
    <link rel="stylesheet" type="text/css" href="/scripts/vendor/rickshaw.min.css"/>
    <link rel="stylesheet" type="text/css" href="/css/ga_report.css"/>
    <script type="text/javascript" src="/scripts/ckanext_ga_reports.js"></script>
    <script type="text/javascript" src="/scripts/vendor/jquery.sparkline.modified.js"></script>
    <script type="text/javascript" src="/scripts/vendor/d3.v2.js"></script>
    <script type="text/javascript" src="/scripts/vendor/d3.layout.min.js"></script>
    <script type="text/javascript" src="/scripts/vendor/rickshaw.min.js"></script>
  </py:def>

  <div py:match="content">

      <h1>Site Usage</h1>

      ${usage_nav('Publishers')}


      <form class="form-inline" action="${h.url_for(controller='ckanext.ga_report.controller:GaDatasetReport',action='publishers')}" method="get">
          <div class="controls">

          ${month_selector(c.month, c.months, c.day)}

           <input class="btn button btn-primary" type='submit' value="Update"/>
          </div>
       </form>

       ${rickshaw_graph(c.top_publishers_graph,'publishers')}
       <table class="table table-condensed table-bordered table-striped">
	 <tr>
	   <th>Publisher</th>
	   <th>Dataset Views</th>
	 </tr>
        <py:for each="publisher, views, visits in c.top_publishers">
	  <tr>
	    <td>
	        ${h.link_to(publisher.title, h.url_for(controller='ckanext.ga_report.controller:GaDatasetReport', action='read_publisher', id=publisher.name) + (("?month=" + c.month) if c.month else ''))}
	    </td>
	    <td>${views}</td>
	  </tr>
        </py:for>
       </table>


  </div>

  <xi:include href="../../layout.html" />

  <py:def function="optional_footer">
    <script type='text/javascript'>
        $('.nav-tabs li a').click(function (e) {
          e.preventDefault();
          $(this).tab('show');
        })
    </script>
  </py:def>

</html>


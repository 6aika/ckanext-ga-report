<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="../ga_util.html" />

  <py:def function="page_title">Site usage</py:def>

  <py:match path="primarysidebar">
    <li class="widget-container boxed widget_text">
      <h4>Download</h4>
      <p><center>
          <a class="btn button btn-primary" href="${h.url_for(controller='ckanext.ga_report.controller:GaReport',action='csv',month=c.month or 'all')}">Download as CSV</a></center>
      </p>
    </li>
    <xi:include href="../notes.html" />

  </py:match>

  <div py:match="content">
      <h1>Site Usage</h1>
      ${usage_nav('Site-wide')}

      <form class="form-inline" action="${h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}" method="get">
          <div class="controls">

          ${month_selector(c.month, c.months, c.day)}

           <input class="btn button btn-primary" type='submit' value="Update"/>
          </div>
       </form>

    <div class="tabbable">
      <ul class="nav nav-tabs">
        <li class="active"><a href="#totals" data-toggle="tab">Totals</a></li>
        <li class="dropdown">
            <a href="#browsers" class="dropdown-toggle" data-toggle="dropdown">Browsers
                <b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li><a href="#browsers_names" data-toggle="tab">Browsers</a></li>
                <li><a href="#browsers_versions" data-toggle="tab">Versions</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="#browsers" class="dropdown-toggle" data-toggle="dropdown">Operating<br/>Systems
                <b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li><a href="#os" data-toggle="tab">Operating Systems</a></li>
                <li><a href="#os_versions" data-toggle="tab">Versions</a></li>
            </ul>
        </li>
        <li class="dropdown">
            <a href="#browsers" class="dropdown-toggle" data-toggle="dropdown">Social Networks
                <b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li><a href="#social_networks" data-toggle="tab">All networks</a></li>
                <li><a href="#social_referrals_totals" data-toggle="tab">Referral links</a></li>
            </ul>
        </li>

        <li><a href="#social_networks" data-toggle="tab"></a></li>
        <li><a href="#languages" data-toggle="tab">Languages</a></li>
        <li><a href="#country" data-toggle="tab">Country</a></li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="totals">
             <h3>Average time on site</h3>
             <div class="chart_container">
               <div id="totals_graph_yaxis" class="yaxis"></div>
               <div id="totals_graph" class="chart"></div>
             </div>

             <br/>
             <h3>Bounce rate (home page)</h3>
             <div class="chart_container">
               <div id="bounce_graph_yaxis" class="yaxis"></div>
               <div id="bounce_graph" class="chart"></div>
             </div>

             <br/>
             <h3>New visits</h3>
             <div class="chart_container">
               <div id="new_visits_graph_yaxis" class="yaxis"></div>
               <div id="new_visits_graph" class="chart"></div>
             </div>

             <br/>
             <h3>Pages per visit</h3>
             <div class="chart_container">
               <div id="pages_per_visit_graph_yaxis" class="yaxis"></div>
               <div id="pages_per_visit_graph" class="chart"></div>
             </div>

             <br/>
             <h3>Total visits</h3>
             <div class="chart_container">
               <div id="total_visits_graph_yaxis" class="yaxis"></div>
               <div id="total_visits_graph" class="chart"></div>
             </div>

             <br/>
             <h3>Total page views</h3>
             <div class="chart_container">
               <div id="total_pageviews_graph_yaxis" class="yaxis"></div>
               <div id="total_pageviews_graph" class="chart"></div>
             </div>

             <br/>
             <p>Left in for comparison</p>
             <table class="table table-condensed table-bordered table-striped">
            	 <tr>
            	   <th>Name</th>
            	   <th>Value</th>
            	 </tr>
                <py:for each="name, value in c.global_totals">
                    <tr>
                        <td>${name}</td>
                        <td>${value}</td>
                    </tr>
                </py:for>
               </table>
        </div>
         <div class="tab-pane" id="browsers_versions">
             <p>Note: Where a browser has a large number of versions, these have been grouped together.</p>
             ${stat_table(c.browser_versions)}
         </div>
         <div class="tab-pane" id="browsers_names">
             ${stat_table(c.browsers)}
         </div>
         <div class="tab-pane" id="os">
             ${stat_table(c.os)}
         </div>
         <div class="tab-pane" id="os_versions">
             ${stat_table(c.os_versions)}
         </div>
        <div class="tab-pane" id="social_referrals_totals">
            <p>Number of visits that were referred from social networks</p>
            ${social_table(c.social_referrer_totals)}
        </div>
        <div class="tab-pane" id="social_networks">
            <p>Percentage of visits that were referred from these social networks</p>

             ${stat_table(c.social_networks, 'Visits')}
        </div>
        <div class="tab-pane" id="languages">
             ${stat_table(c.languages)}
        </div>
        <div class="tab-pane" id="country">
             ${stat_table(c.country)}
        </div>


       </div>
     </div>



  </div>
  <py:def function="optional_footer">
    <link href="/css/rickshaw.min.css" rel="stylesheet"/>
    <script src="/js/d3.min.js"></script>
    <script src="/js/d3.layout.min.js"></script>
    <script src="/js/rickshaw.min.js"></script>
    <script src="/js/ga_graphs.js"></script>

    <script type='text/javascript'>
      $('a[data-toggle="tab"]').on('shown', function (e) {
        var tgt = $(e.target).attr('href') + "_graph";
        if ($(tgt).children().length == 0 ) {
          show_graph($(e.target).attr('href').substr(1), $(tgt))
        }
      })

      barChart("totals", "totals_graph")
      barChart("bounce", "bounce_graph")
      lineChart("new_visits", "new_visits_graph")

      lineChart("pages_per_visit", "pages_per_visit_graph")
      lineChart("total_visits", "total_visits_graph")
      lineChart("total_pageviews", "total_pageviews_graph")

    </script>
  </py:def>

  <xi:include href="../../layout.html" />

</html>



